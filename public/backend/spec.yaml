openapi: "3.0.0"
info:
  title: eCommerce webSite API
  description: 'This is a bookstore server with a book inventory, users with a shopping cart, a collection of event where the authors present their books.'
  version: "1.0.0"
  contact:
    email: "salvatore.bova@mail.polimi.it"
servers:
  - description: Url where you can find our website
    url: https://bova-colombo-hyp2019.herokuapp.com/
tags:
  - name: "Book"
    description: "operation regarding the books"
  - name: "Cart"
    description: "operation regarding the cart"
  - name: "Auth"
    description: "operations about registration/login/logout"
  - name: "Event"
    description: "operation regarding the events"
  - name: "Author"
    description: "operation regarding the authors"
paths:
  /book:
    get:
      tags:
      - Book
      summary: "Books available in the inventory."
      description: "List of books available in the inventory"
      operationId: getBook
      parameters:
        - $ref: '#/components/parameters/title'
        - $ref: '#/components/parameters/author'
        - $ref: '#/components/parameters/genre'
        - $ref: '#/components/parameters/theme'
        - $ref: '#/components/parameters/bestseller'
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                type: array
                items:
                  oneOf:
                    - $ref: '#/components/schemas/Book'
                    - $ref: '#/components/schemas/Bestseller'
                  discriminator:
                    propertyName: data_rank
        '400':
          description: "Invalid input supplied"
        '404':
          description: "No books founded"
  /book/{bookID}:
    get:
      tags:
      - Book
      summary: "get book by ID"
      description: "return the information of a specific book through his ID"
      operationId: getBooksByID
      parameters:
      - name: "bookID"
        in: "path"
        description: "The book's id that needs to be fetched."
        required: true
        schema:
          type: integer
          format: int64
      responses:
        '200':
          description: "successful operation"
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Book'
        '400':
          description: "Invalid id supplied"
        '404':
          description: "Book not found"
  /book/{bookID}/reviews:
    get:
      tags:
      - Book
      summary: "get reviews of a book"
      description: "return all the reviews of a specific book through his ID"
      operationId: myReviews
      parameters:
      - name: "bookID"
        in: "path"
        description: "The book's id that we need the reviews to be fetched."
        required: true
        schema:
          type: integer
          format: int64
      responses:
        '200':
          description: "successful operation"
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Review'
        '400':
          description: "Invalid id supplied"
        '404':
          description: "Book not found"
    post:
      tags:
      - Book
      summary: "add review"
      description: "add a review to a specific book through his ID"
      operationId: addReview
      requestBody:
        $ref: '#/components/requestBodies/reviewBody'
      parameters:
      - name: "bookID"
        in: "path"
        description: "The book's id that needs to be fetched."
        required: true
        schema:
          type: integer
          format: int64
      - $ref: '#/components/parameters/cookie'
      responses:
        '200':
          description: "successful operation"
          content:
            application/json:
              schema:
                type: object
                properties:
                  id:
                    type: integer
                    format: int64
                  message:
                    type: string
        '400':
          description: "book already reviewed"
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                example:
                  message: "You already reviewed this book!"
        '403':
          description: "invalid input"
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                example:
                  message: "Review too short!"
        '404':
          description: "user not logged"
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                example:
                  message: "You are not logged!"
  /book/{bookID}/reviews/score:
    get:
      tags:
      - Book
      summary: "get avg by ID"
      description: "return the average of the reviews of a specific book through his ID"
      operationId: myReviewScore
      parameters:
      - name: "bookID"
        in: "path"
        description: "The book's id that we need the avg rating to be fetched."
        required: true
        schema:
          type: integer
          format: int64
      responses:
        '200':
          description: "successful operation"
          content:
            application/json:
              schema:
                type: object
                properties:
                  avg:
                    type: integer
                    format: int64
        '400':
          description: "Invalid id supplied"
        '404':
          description: "Book not found"
  /book/{bookID}/similar/{idSimilar}:
    get:
      tags:
      - Book
      summary: "get similar books"
      description: "return a list of books similar to the one specified through its ID"
      operationId: mySimilar
      parameters:
      - name: "bookID"
        in: "path"
        description: "The book's id that needs to be fetched."
        required: true
        schema:
          type: integer
          format: int64
      - name: "idSimilar"
        in: "path"
        description: "The kind of similarity."
        required: true
        schema:
          type: integer
          format: int64
      responses:
        '200':
          description: "successful operation"
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Book'
        '400':
          description: "Invalid id supplied"
        '404':
          description: "Book not found"
  /book/get/bestsellerMonth:
    get:
      tags:
      - Book
      summary: "get bestseller of the month"
      description: "return a list of 8 books that are the bestsellers for the current month"
      operationId: getBestSeller
      responses:
        '200':
          description: "successful operation"
          content:
            application/json:
              schema:
                type: array
                items:
                    $ref: '#/components/schemas/Bestseller'


  /event:
    get:
      tags:
      - Event
      summary: "Events available."
      description: "List of the events available in our website."
      operationId: getEvents
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Event'
        '404':
          description: "No events founded"
  /event/{eventID}:
    get:
      tags:
      - Event
      summary: "get event by ID"
      description: "return the information of a specific event through his ID"
      operationId: getEventByID
      parameters:
      - name: "eventID"
        in: "path"
        description: "The event's id that needs to be fetched."
        required: true
        schema:
          type: integer
          format: int64
      responses:
        '200':
          description: "successful operation"
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Event'
        '400':
          description: "Invalid id supplied"
        '404':
          description: "Event not found"
  /event/month/{idMonth}:
    get:
      tags:
      - Event
      summary: "get event by month"
      description: "return all the events for a specific month"
      operationId: getEventsByMonth
      parameters:
      - name: "idMonth"
        in: "path"
        description: "The month's id that we need to fetch all the events. (i.e. 01 = January and so on)"
        required: true
        schema:
          type: integer
          format: int64
      responses:
        '200':
          description: "successful operation"
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Event'
        '400':
          description: "Invalid id supplied"
        '404':
          description: "Event not found"
  /event/city/{cityID}:
    get:
      tags:
      - Event
      summary: "get event by city"
      description: "return all the events for a specific city"
      operationId: getEventsByCity
      parameters:
      - name: "cityID"
        in: "path"
        description: "The city's id that we need to fetch all the events."
        required: true
        schema:
          type: integer
          format: int64
      responses:
        '200':
          description: "successful operation"
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Event'
        '400':
          description: "Invalid id supplied"
        '404':
          description: "Event not found"
  /event/book/{bookID}:
    get:
      tags:
      - Event
      summary: "get events by book ID"
      description: "return the list of events for a specific book through his ID"
      operationId: getEventByBookID
      parameters:
      - name: "bookID"
        in: "path"
        description: "The book's id that needs to be fetched."
        required: true
        schema:
          type: integer
          format: int64
      responses:
        '200':
          description: "successful operation"
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Event'
        '400':
          description: "Invalid id supplied"
        '404':
          description: "Book not found"
  /event/this/month:
    get:
      tags:
      - Event
      summary: "Events available during this month."
      description: "List of the events available in our website for the current month."
      operationId: getEventThisMonth
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Event'
        '400':
          description: "Invalid input supplied"
        '404':
          description: "No events founded"


  /author:
    get:
      tags:
      - Author
      summary: "List of authors"
      description: "return a list of all the authors available in our website"
      operationId: getAuthors
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Author'
        '400':
          description: "unexpected error"
  /author/{authorID}:
    get:
      tags:
        - Author
      summary: "get author by ID"
      description: "return the information of a specific author through his ID"
      operationId: getAuthorByID
      parameters:
      - name: "authorID"
        in: "path"
        description: "The author's id that needs to be fetched."
        required: true
        schema:
          type: integer
          format: int64
      responses:
        '200':
          description: "successful operation"
          content:
            application/json:
              schema:
                type: object
                properties:
                  author:
                    $ref: '#/components/schemas/Author'
                  myBooks:
                    type: object
                    properties:
                      id:
                        type: integer
                        format: int64
                      title:
                        type: string
        '400':
          description: "Invalid id supplied"
        '404':
          description: "Author not found"


  /auth/signup:
    post:
      tags:
      - Auth
      summary: "Register"
      description: "Register into the store"
      operationId: "signUp"
      requestBody:
        $ref: '#/components/requestBodies/registrationForm'
      responses:
        '201':
          description: 'Successful Created'
          content:
            application/json:
              schema:
                type: object
                properties:
                  id:
                    type: integer
                    format: int64
                  message:
                    type: string
        '400':
          description: "Email in use"
        '404':
          description: "some invalid input"
  /auth/login:
    post:
      tags:
      - Auth
      summary: "Login"
      description: "Login with a form"
      operationId: login
      requestBody:
        $ref: '#/components/requestBodies/Login'
      responses:
        '200':
          description: "successful operation"
          headers:
            Set-Cookie:
              schema:
                type: string
                example: user_id=1; Path=/; HttpOnly, signed, secure
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
        '400':
          description: "password wrong or email doesn't exist"
        '404':
          description: "Invalid username/password supplied"
  /auth/logout:
    delete:
      tags:
      - Auth
      summary: "Logout"
      description: "Logs out current logged in user session"
      operationId: "logoutUser"
      parameters:
        - $ref: '#/components/parameters/cookie'
      responses:
        '200':
          description: "successful operation"
          headers:
            Set-Cookie:
              schema:
                type: string
                example: user_id=; Path=/; HttpOnly, signed, secure
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                example:
                  message: "Logged out!"
        '400':
          description: "user not logged"
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                example:
                  message: "You are not logged!"

  /cart:
    get:
      tags:
      - Cart
      summary: "Show the content of the shopping cart of an user"
      operationId: getCart
      parameters:
        - $ref: '#/components/parameters/cookie'
      responses:
        200:
          description: successful operation
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Cart'
        400:
          description: 'user not logged'
          content:
            application/json:
              schema:
                type: object
                properties:
                  text:
                    type: string
                example:
                  text: "You are not logged, you have to log in to see your cart"
        404:
          description: 'cart empty'
          content:
            application/json:
              schema:
                type: object
                properties:
                  text:
                    type: string
                example:
                  text: "cart empty, add a book!"

    post:
      tags:
      - Cart
      summary: "Add a books into the shopping cart"
      operationId: addBook
      parameters:
        - $ref: '#/components/parameters/cookie'
      requestBody:
        description: "A JSON object containing information to login"
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                id:
                  type: integer
                  format: int64
      responses:
        '200':
          description: 'successful operation'
          headers:
            Set-Cookie:
              $ref: '#/components/parameters/cartSession'
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
        '400':
          description: "user not logged"
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
        '404':
          description: "book not found"


    delete:
      tags:
      - Cart
      summary: "Empty cart"
      description: "delete all the books in the cart"
      operationId: emptyCart
      parameters:
        - $ref: '#/components/parameters/cartSession'
      responses:
        '200':
          description: 'Book removed successfully'
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                example:
                  message: "Cart emptied!"
        '404':
          description: 'No books in your cart'
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                example:
                  message: "There are no books in your cart"
  /cart/{bookID}:
    delete:
      tags:
        - Cart
      summary: "remove books"
      description: "remove a whole block of the same book from the cart through its ID"
      operationId: deleteBook
      parameters:
      - name: "bookID"
        in: "path"
        description: "the book id that needs to be removed."
        required: true
        schema:
          type: integer
          format: int64
      - $ref: '#/components/parameters/cartSession'
      responses:
        '200':
          description: "successful operation"
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                example:
                  message: "Successfully removed!"
        '400':
          description: "Invalid id supplied"
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                example:
                  message: "cart empty!"
        '404':
          description: "Author not found"
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                example:
                  message: "This book is not in your cart"
    patch:
      tags:
        - Cart
      summary: "remove books"
      description: "decrease of one unit the book specified through its ID"
      operationId: remove1Book
      parameters:
      - name: "bookID"
        in: "path"
        description: "the book id that needs to be added."
        required: true
        schema:
          type: integer
          format: int64
      - $ref: '#/components/parameters/cartSession'
      responses:
        '200':
          description: "successful operation"
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                example:
                  message: "Successfully removed!"
        '400':
          description: "Invalid id supplied"
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                example:
                  message: "cart empty!"
        '404':
          description: "Author not found"
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                example:
                  message: "This book is not in your cart"


components:
  parameters:
    cookie:
      name: user_id
      in: cookie
      description: ""
      schema:
        type: string
    cartSession:
      name: connection.sid
      in: cookie
      description: ""
      schema:
        type: string
    title:
      name: title
      in: query
      description: "Book's title. The API responds with a list of results that match a searching word."
      schema:
        type: string
    author:
      name: author
      in: query
      description: "Book's author Name. The API responds with a list of results that match a searching word."
      schema:
        type: string
    genre:
      name: genre
      in: query
      description: "Book's genre. The API responds with a list of results that match a searching word."
      schema:
        type: string
    theme:
      name: theme
      in: query
      description: "Book's theme. The API responds with a list of results that match a searching word."
      schema:
        type: string
    bestseller:
      name: bestseller
      in: query
      description: "The API responds with a list of all the bestsellers."
      schema:
        type: string
    favorite:
      name: favorite
      in: query
      description: "The API responds with a list of all the books suggested."
      schema:
        type: string
    eventAuthor:
      name: eventAuthor
      in: query
      description: "Author at the event name. The API responds with a list of results that match a searching word."
      schema:
        type: string
    eventBook:
      name: eventBookName
      in: query
      description: "Presented book's name. The API responds with a list of results that match a searching word."
      schema:
        type: string
    eventDate:
      name: eventDate
      in: query
      description: "Event's date. The API responds with a list of results that match a searching word."
      schema:
        type: string
    eventLocation:
      name: eventLocation
      in: query
      description: "Event's location. The API responds with a list of results that match a searching word."
      schema:
        type: string
________________________________________________________________________________
  schemas:
    ArtisticEvent:
      type: object
      properties:
        idevent:
          type: integer
          format: integer
        title:
          type: string
          format: character varying
        description:
          type: string
          format: character varying
        place:
          type: string
          format: character varying
        type:
          type: string
          format: character varying
        dateAndTime:
          type: string
          format: timestamp without time zone
        idseminar:
          type: integer
          format: integer
      example:
        idevent: 1
        title: "Rock Show"
        description: "the x band will perform a rock show in y location"
        place: "Milan"
        type: "music"
        dateAndTime: "2019-09-21 15:30:00"
        idseminar: 4
    performer:
      type: object
      properties:
        idperformer:
          type: integer
          format: integer
        name:
          type: string
          format: character varying
        members:
          type: string
          format: character varying
        isgroup:
          type: boolean
          format: boolean
        affiliation:
          type: string
          format: character varying
        details:
          type: string
          format: character varying
        achievements:
          type: string
          format: character varying
        shortdescription:
          type: string
          format: character varying
      example:
        idperformer: 2
        name: "Against the Current"
        members: "Chrissy Costanza, Will Ferri, Dan Gow"
        isgroup: true
        affiliation: "Fueled by Ramen"
        details: "Against The Current (often abbreviated as ATC) is an American pop rock band based in Poughkeepsie, New York, and formed in 2011. More specifically, they play various variations of pop and rock, going from pure pop to pop punk and alternative rock. Against the Current was formed in early 2011 by Dan Gow, Will Ferri, and Jeremy Rompala and was later joined by Chrissy Costanza in the summer of 2011 after being introduced to Gow, Ferri, and Rompala through a mutual friend."
        achievements: ""
        shortdescription: "American rock pop band"
    performs:
      type: object
      properties:
        idperformer:
          type: integer
          format: integer
        idevent:
          type: integer
          format: integer
      example:
        idperformer: 3
        idevent: 2
    reservationArtisticEvent:
      type: object
      properties:
        iduser:
          type: integer
          format: integer
        idevent:
          type: integer
          format: integer
      example:
        iduser: 5
        idevent: 9
________________________________________________________________________________
  requestBodies:
    registrationForm:
      description: "A JSON object containing user information"
      required: true
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/User'
    Login:
      description: "A JSON object containing information to login"
      required: true
      content:
        application/json:
          schema:
            type: object
            properties:
              email:
                type: string
              password:
                type: string
    reviewBody:
      description: "A JSON object containing information to add a reviews"
      required: true
      content:
        application/json:
          schema:
            type: object
            properties:
              message:
                type: string
                format: text
              rating:
                type: integer
                format: int64
                minimum: 1
                maximum: 5
